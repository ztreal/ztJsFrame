<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html>
 	<head>
  		<link href="../../css/style.css" rel="stylesheet" type="text/css" /> 
		<link rel="stylesheet" type="text/css" media="screen" href="../../common/js/jqgrid/themes/redmond/jquery-ui-1.8.2.custom.css" /> 
		<link rel="stylesheet" type="text/css" media="screen" href="../../common/js/jqgrid/themes/ui.jqgrid.css" /> 
		<link rel="stylesheet" type="text/css" media="screen" href="../../common/js/jqgrid/themes/ui.multiselect.css" />
			
		<script src="../../common/js/jquery-1.4.2.min.js" type="text/javascript"></script> 
		<script src="../../common/js/base.js" type="text/javascript"></script>
		<script src="../../common/js/jqgrid/js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script> 
		<script src="../../common/js/jqgrid/js/jquery.layout.js" type="text/javascript"></script> 
		<script src="../../common/js/jqgrid/js/i18n/grid.locale-cn.js" type="text/javascript"></script> 
		<script src="../../common/js/jqgrid/js/ui.multiselect.js" type="text/javascript"></script> 
		<script src="../../common/js/jqgrid/js/jquery.jqGrid.js" type="text/javascript"></script> 
	
	<script type="text/javascript">
		var mydata = [
			{id:"1",taskid:'20101011SDDC001',taskname:'四川省直管干部立案调查任务 ',publisher:'中央纪委监察部',startdate:'2010-10-9',enddate:'2010-10-22',state:'未发布'} ,
			{id:"2",taskid:'20101011SDDC002',taskname:'河南省党风专项调查任务',publisher:'中央纪委监察部',startdate:'2010-10-2',enddate:'2010-10-12',state:'未发布'} ,
			{id:"3",taskid:'20101011SDDC003',taskname:'贵州省交通运输系统突出问题专项治理任务',publisher:'中央纪委监察部',startdate:'2010-10-9',enddate:'2010-10-22',state:'未发布'} ,
			{id:"4",taskid:'20101011SDDC004',taskname:'山东省农村公路建设纪检监察巡查任务',publisher:'中央纪委监察部',startdate:'2010-10-11',enddate:'2010-10-21',state:'已发布'} ,
			{id:"5",taskid:'20101011SDDC005',taskname:'云南省煤焦领域反腐败专项斗争',publisher:'中央纪委监察部',startdate:'2010-10-5',enddate:'2010-10-15',state:'已发布'} ,
			{id:"6",taskid:'20101011SDDC006',taskname:'湖南省农村公路建设纪检监察巡查任务',publisher:'中央纪委监察部',startdate:'2010-10-9',enddate:'2010-10-22',state:'未发布'} ,
			{id:"7",taskid:'20101011SDDC007',taskname:'广东省交通运输系统突出问题专项治理任务',publisher:'中央纪委监察部',startdate:'2010-10-9',enddate:'2010-10-22',state:'未发布'} ,
			{id:"8",taskid:'20101011SDDC008',taskname:'安徽省直管干部立案调查任务',publisher:'中央纪委监察部',startdate:'2010-10-11',enddate:'2010-10-21',state:'已发布'},
			{id:"9",taskid:'20101011SDDC009',taskname:'宁波市第一医院19名医生收受药品回扣被处分',publisher:'中央纪委监察部',startdate:'2010-10-7',enddate:'2010-10-26',state:'已发布'},
			{id:"10",taskid:'20101011SDDC010',taskname:'国家税务总局稽查局一处长因受贿被判13年',publisher:'中央纪委监察部',startdate:'2010-10-1',enddate:'2010-11-26',state:'已发布'}
		];
		var units = [
			{id:"1", unitno:'国家统计局纪检监察机关', forward:'<input name="unit1" type="radio" value="否" disabled="true">是<input name="unit1" type="radio" value="否" disabled="true">否'},
			{id:"2", unitno:'国家林业局纪检监察机关', forward:'<input name="unit2" type="radio" value="否" disabled="true">是<input name="unit2" type="radio" value="否" disabled="true">否'},
			{id:"3", unitno:'国家知识产权局纪检监察机关', forward:'<input name="unit3" type="radio" value="否" disabled="true">是<input name="unit3" type="radio" value="否" disabled="true">否'},
			{id:"4", unitno:'国家安全生产监督管理总局纪检监察机关', forward:'<input name="unit4" type="radio" value="否" disabled="true">是<input name="unit4" type="radio" value="否" disabled="true">否'},
			{id:"5", unitno:'国家旅游局纪检监察机关', forward:'<input name="unit5" type="radio" value="否" disabled="true">是<input name="unit5" type="radio" value="否" disabled="true">否'},
			{id:"6", unitno:'国务院参事室纪检监察机关', forward:'<input name="unit6" type="radio" value="否" disabled="true">是<input name="unit6" type="radio" value="否" disabled="true">否'},
			{id:"7", unitno:'文化部纪检监察机关', forward:'<input name="unit7" type="radio" value="否" disabled="true">是<input name="unit7" type="radio" value="否" disabled="true">否'},
			{id:"8", unitno:'卫生部纪检监察机关', forward:'<input name="unit8" type="radio" value="否" disabled="true">是<input name="unit8" type="radio" value="否" disabled="true">否'},
			{id:"9", unitno:'国家人口和计划生育委员会纪检监察机关', forward:'<input name="unit9" type="radio" value="否" disabled="true">是<input name="unit9" type="radio" value="否" disabled="true">否'},
			{id:"10", unitno:'审计署纪检监察机关', forward:'<input name="unit10" type="radio" value="否" disabled="true">是<input name="unit10" type="radio" value="否" disabled="true">否'},
			{id:"11", unitno:'国家广播电影电视总局纪检监察机关', forward:'<input name="unit11" type="radio" value="否" disabled="true">是<input name="unit11" type="radio" value="否" disabled="true">否'}
		];
        
		jQuery(document).ready(function(){
			jQuery("#list486").jqGrid({
				width: document.body.clientWidth,
				data: mydata,
				datatype: "local",/*可以使用local,json,xml*/
				height: 'auto',
				rowNum: 10,
				colNames:['序号','任务编号','任务名称','发布者', '发布时间', '结束时间', '状态'],
				colModel:[
					{name:'id',index:'id', width:10, sorttype:"int",align:"center",hidegrid:false},
					{name:'taskid',index:'taskid', width:50,align:"left"},
					{name:'taskname',index:'taskname', width:100, align:"left"},
					{name:'publisher',index:'publisher', width:40, align:"left"},
					{name:'startdate',index:'startdate', width:50, align:"center",sorttype:"float", editable:true,summaryType:'max', summaryTpl:'<b>Max: {0}</b>'},
					{name:'enddate',index:'enddate', width:50, align:"center",sorttype:"float", editable:true,summaryType:'mix', summaryTpl:'<b>Max: {0}</b>'},
					{name:'state',index:'state', width:25, align:"center",sortable:false}
				],
				pager: "#plist486", /*绑定的DIV*/
				viewrecords: true,
				sortname: 'id',
				caption: "任务列表",
				multiselect:true
			}).jqGrid('hideCol',["id"]);
			jQuery("#list486").jqGrid('navGrid','#plist486',{add:false,edit:false,del:false,search:false,refresh:true});
			
			jQuery("#list586").jqGrid({
				width:330,
				data: units,
				datatype: "local",/*可以使用local,json,xml*/
				height: 'auto',
				rowNum: 6,
				colNames:['序号','单位名称','是否转发'],
				colModel:[
					{name:'id',index:'id', width:20, sorttype:"int",align:"center",hidegrid:false},
					{name:'unitno',index:'unitno', width:230,align:"left"},
					{name:'forward',index:'forward', width:80, align:"center"},
				],
				pager: "#plist586", /*绑定的DIV*/
				viewrecords: true,
				sortname: 'id',
				caption: "单位列表",
				multiselect:true,
				onSelectRow: function(id, state){
					var radios = document.forms['receiver']['unit'+id];
					if(state)
					{
						radios[0].disabled = false;
						radios[1].disabled = false;
					}
					else
					{
						radios[0].checked = false;
						radios[1].checked = false;
						radios[0].disabled = true;
						radios[1].disabled = true;
					}
				},
				onSelectAll: function(ids, state) {
					for(var i=1; i<ids.length; i++)
					{
						var radios = document.forms['receiver']['unit'+ids[i]];
						if(state)
						{
							radios[0].disabled = false;
							radios[1].disabled = false;
						}
						else
						{
							radios[0].checked = false;
							radios[1].checked = false;
							radios[0].disabled = true;
							radios[1].disabled = true;
						}
					}
				}
			}).jqGrid('hideCol',["id"]);
			jQuery("#list586").jqGrid('navGrid','#plist586',{add:false,edit:false,del:false,search:false,refresh:true});
			
			/**new task*/
			$("#newTask").click(function()
			{
				window.location.href = 'createTask.html';
			});	
			
			/**edit task*/
			jQuery("#editTask").click(function() 
			{
				var items = jQuery("#list486").jqGrid('getGridParam','selarrrow');
				if (items && items != '')	{
					if(items.length != 1)
					{
						alert("该功能只能选择一项任务!");
					}
					else
					{
						var row = jQuery("#list486").jqGrid('getRowData', items[0]);
						//alert("id="+row.id+", taskid="+row.taskid);
						window.location.href = 'editTask.html';
					}
				} else { 
					alert("请先选择数据!");
				}
			});
			
			/**delete task*/
			jQuery("#deleteTask").click(function() 
			{
				var items = jQuery("#list486").jqGrid('getGridParam','selarrrow');
				if (items && items != '')	
				{ 
					for(var i=0; i<items.length; i++)
					{
						var row = jQuery("#list486").jqGrid('getRowData', items[i]);
						if(row.state == '已发布')
						{
							alert("已经发布的任务需要撤销后才能删除!");	
							return;
						}
						
					}
					for(var i=items.length-1; i>=0; i--)
					{
						jQuery("#list486").jqGrid('delRowData', items[i]);
					}
				}
				else
				{
					alert("请选择数据!");
				}
			});

			/**publish task*/
			jQuery("#publishTask").click(function() 
			{
				var items = jQuery("#list486").jqGrid('getGridParam','selarrrow');
				if (items && items != '')	
				{ 
					for(var i=0; i<items.length; i++)
					{
						var row = jQuery("#list486").jqGrid('getRowData', items[i]);
						if(row.state == '未发布')
						{
							$("#dialog-confirm").dialog(
							{
								resizable: false,
								height:310,
								width:350,
								modal: true,
								buttons: 
								{
									"取消": function() {
										$( this ).dialog( "close" );
									},
									"确定": function() {
										$( this ).dialog( "close" );
										window.location='taskManage.html';
									}
								}
							});
							$("#list486").setRowData(items[i], { state:"已发布"});
						}
						else
						{
							alert('该任务已经发布!');	
						}
					}
				}
				else
				{
					alert("请选择数据!");
				}
			});
			
			/**publish task*/
			jQuery("#escPublish").click(function() 
			{
				var items = jQuery("#list486").jqGrid('getGridParam','selarrrow');
				if (items && items != '')	
				{ 
					for(var i=0; i<items.length; i++)
					{
						var row = jQuery("#list486").jqGrid('getRowData', items[i]);
						if(row.state == '已发布')
						{
							$("#list486").setRowData(items[i], { state:"未发布"});
						}
					}
				}
				else
				{
					alert("请选择数据!");
				}
			});
			
			/**publish task*/
			jQuery("#downloadTask").click(function() 
			{
				var items = jQuery("#list486").jqGrid('getGridParam','selarrrow');
				if (items && items != '')	
				{ 
				}
				else
				{
					alert("请选择数据!");
				}
			});
		});
	</script>
	<style type="text/css">
		#calbody{
			widows:198px;
		}
		.cbox{
			width:20px;
		}
		input{width:auto}
		input[type="text"] { width: 100px; } 
	
	</style>
  </head>
  
  <body>
  	<div style="width:100%;background-color:#f4f4f4; height:32px; font-size:12px; "><div style="padding-left:10px;padding-top:8px;">当前位置： 专项报送&nbsp;<font style="font-family:'宋体'">></font>&nbsp;定制任务</div></div>
	<br />
  	<div style="background:#ebf6fc; HEIGHT: 27px;width:100%;border:#4297d7 0px solid">
		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px" class="clbutton" id="newTask">
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" id="add">
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">新建任务</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
 		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px" class="clbutton" id="editTask">
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" id="edit">
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">编辑任务</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
  		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px"  class="clbutton"  id="deleteTask">
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" >
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">删除任务</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
  		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px"  class="clbutton"  id="publishTask" >
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" >
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">发布任务</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
 		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px"  class="clbutton"  id="escPublish" >
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" >
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">撤消发布</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
 		<DIV style="PADDING-RIGHT: 10px; FLOAT: left; padding-left:10px; PADDING-TOP: 3px"  class="clbutton"  id="downloadTask" >
			<table border="0" cellpadding="0" cellspacing="0" class="blue_1_j" >
			  <tr>
			    <td  class="blue_2_j"></td>
			    <td class="blue_4_j">下载任务包</td>
			    <td class="blue_3_j"></td>
			  </tr>
			</table>
 		</DIV> 
 	</div>
 	
 	<div style="height:25px;">&nbsp;</div>

	<table id="list486"></table>
    <div id="plist486"></div> 
    
    <div id="dialog-confirm" title="请选择接收的单位" style="display:none">
    	<form name="receiver">
			<table id="list586"></table>
    		<div id="plist586"></div>
    	</form> 
	</div>
  </body>
</html>
